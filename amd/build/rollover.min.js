define(["core/ajax","core/notification"],function(a,b){var c="*",d="",e=$("#rollovercontainer").attr("data-id"),f=function(){$("#rollovercontainer").html("<p>Something went wrong! Please refresh and try again or contact your FLT.</p>")},g=function(){var c=a.call([{methodname:"get_rollover_status",args:{courseid:e}}]);c[0].done(function(a){a.progress,a.status_str;return"rollover_error"==a.status_code?void f():(2==a.status_code&&(window.location=M.cfg.wwwroot+"/course/view.php?id="+e),a.progress>-1&&$("#rollovercontainer .progress-bar").attr("aria-valuenow",a.progress).css("width",a.progress+"%"),$("#rollovercontainer .progress-bar").html(a.status_str),void setTimeout(function(){g()},2e3))}),c[0].fail(b.exception)},h=function(){$("#rollovercontainer").html('            <p class="lead">Please wait... your course is being rolled over.</p>            <div class="row">                <div class="col-xs-8 col-xs-offset-2">                    <div class="progress">                        <div class="progress-bar" role="progressbar" aria-valuenow="15" aria-valuemin="0" aria-valuemax="100" style="width: 15%">                            <i class="fa fa-spin fa-spinner"></i>                        </div>                    </div>                </div>            </div>            <p>Note: you can safely close this page and check back later.</p>        '),g()},i=function(b,c){var d=a.call([{methodname:"schedule_rollover",args:{source:b,target:c}}]);d[0].done(function(a){h()}),d[0].fail(function(a){f()})},j=function(){if(!(d.length<2)){var f=a.call([{methodname:"search_rollover_source_list",args:{search:d,target:e,dist:c}}]);f[0].done(function(a){var b="";$.each(a,function(a,c){var d='<button class="btn btn-default" data-id="'+c.id+'">Rollover</button>';b+="<tr><td>"+c.moodle_dist+"</td><td>"+c.shortname+"</td><td>"+c.fullname+'</td><td class="action">'+d+"</td></tr>"}),$("#rollover-options").html("<table><thead><tr><th>Moodle</th><th>Shortname</th><th>Fullname</th><th>Action</th></tr></thead><tbody>"+b+"</tbody></table>"),$("#rollover-options td.action button").on("click",function(a){return a.preventDefault(),$("#rollovercontainer").html('<div class="text-center"><i class="fa fa-spinner fa-spin"></i></div>'),i($(this).attr("data-id"),e),!1})}),f[0].fail(b.exception)}};return{init:function(){$("#moodle-select a").on("click",function(a){return a.preventDefault(),$("#moodle-select").dropdown("toggle"),c=$(this).attr("data-name"),$("#moodle-select-button").html($(this).text()+' <span class="caret"></span>'),j(),!1}),$("#moodle-search").on("keyup",function(){d=$(this).val(),j()}),$("#currentrollover").length>0&&h()}}});